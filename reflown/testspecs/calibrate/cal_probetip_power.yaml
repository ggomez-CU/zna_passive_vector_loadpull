name: cal_probetip_power
requires: [TUNER, VNA, PM]

parameters: {probe_calfile: Cal1.cal, PM_calfile: Cal2.cal, PM_sparameters: PM.s1p}

steps:
  - calibrate:
      name: power_coupling
      force: false
      do:
        - call: {inst: TUNER, method: preset}
        - measure: 
            inst: VNA
            method: get_error_terms
            args: 
              filename: "${PM_calfile}"
            save_as: tier1_cal
        - measure: 
            inst: VNA
            method: get_error_terms
            args: 
              filename: "${probe_calfile}"
            save_as: tier2_cal
        - measure: 
            inst: VNA
            method: capture_point
            save_as: wave_values
        - transform:
            method: cal_import_pms1p
            args:
              PM_s1p: ${PM_sparameters}
            save_as: pm_s1p_data
        - transform:
            method: cal_power_coupling
            args:
              tier1_cal: ${tier1_cal}
              tier2_cal: ${tier2_cal}
              pm_s1p: ${pm_s1p_data}
            save_as: power_coupling
        - save: power_coupling


